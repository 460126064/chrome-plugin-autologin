(()=>{const o={getElement(t){let e=t;for(;e&&!this.getUnique(e);)e=t.parentElement;return e},getUnique(t){let e="",n="",r="";return t.id&&(n=`#${t.id}`),t.className&&(e=`.${t.className.trim().replace(/\s+/g,".")}`),r=t.getAttributeNames().map(i=>{if(i==="id"||i==="class"||i==="style")return"";const s=t.getAttribute(i)||"";return`[${i}${s?'="'+s+'"':""}]`}).join(""),!n&&!e&&!r?"":`${t.nodeName.toLowerCase()}${n}${e}${r}`},getStorage(t){return new Promise(e=>{chrome.storage.sync.get(t,n=>{e(n)})})},setStorage(t){return new Promise(e=>{chrome.storage.sync.set(t,()=>{e(void 0)})})},triggerEvent(t,e,n){n&&(e.value=n);const r=new CustomEvent(t,{detail:{value:n}});e.dispatchEvent(r)},injectScript(t="/static/js/inject.js"){var e=document.createElement("script");e.setAttribute("type","text/javascript"),e.src=chrome.runtime.getURL(t),e.onload=function(){document.body.removeChild(e)},document.body.appendChild(e)}};let c;o.injectScript(),document.addEventListener("contextmenu",function(t){c=t.target},!0),chrome.runtime.onMessage.addListener(async t=>{const{menuItemId:e,type:n,account:r,pwd:g,btn:i}=t;let{pageUrls:s={}}=await o.getStorage(["pageUrls"]),a=s[location.href];if(s[location.href]||(s[location.href]=a={}),n==="manual"){Object.assign(a,{ACCOUNT_EL:r||a.ACCOUNT_EL,PWD_EL:g||a.PWD_EL,BTN_EL:i||a.BTN_EL}),await o.setStorage({pageUrls:s});return}if(e==="ACCOUNT"||e==="PWD"){Object.assign(a,{[e]:c.value,[`${e}_EL`]:o.getUnique(c)}),console.log(`${e} is set to ${c.value}`),console.log(`${e}_EL is set to ${o.getUnique(c)}`),await o.setStorage({pageUrls:s});return}Object.assign(a,{[`${e}_EL`]:o.getUnique(o.getElement(c))}),console.log(`${e}_EL is set to ${o.getUnique(o.getElement(c))}`),await o.setStorage({pageUrls:s})}),window.addEventListener("load",async()=>{let{pageUrls:t={}}=await o.getStorage(["pageUrls"]);console.log(t,"pageUrls"),t[location.href]&&setTimeout(async()=>{const e=t[location.href],{ACCOUNT:n,PWD:r,ACCOUNT_EL:g,PWD_EL:i,BTN_EL:s}=e;(n||r)&&s&&(["input","change","focus"].forEach(u=>{const l=document.querySelector(g),d=document.querySelector(i);o.triggerEvent(u,l,n),o.triggerEvent(u,d,r)}),window.postMessage({BTN_EL:s,type:"submit"},location.origin))},200)})})();
